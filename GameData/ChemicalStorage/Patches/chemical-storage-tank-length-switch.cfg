@PART[chemical-storage-tank-*]
{
	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = lengthSwitch
		parentID = fuelSwitch
		switcherDescription = Length

		SUBTYPE
		{
			name = 1
			title = 1 (1.875m)
			primaryColor = White
			secondaryColor = White
		}
		SUBTYPE
		{
			name = 1.5
			title = 1.5 (2.8125m)
			primaryColor = White
			secondaryColor = White
			addedCost = 0.5
			addedMass = 0.5
			volumeAddedToParent = 0.5
			transform = cylinderHalf
			transform = lidHorizontal
			NODE
			{
				name = top
				relativePosition = 1.5
			}
			NODE
			{
				name = bottom
				relativePosition = -1.5
			}
			TRANSFORM
			{
				name = tankTop
				relativePosition = 0.5
			}
			TRANSFORM
			{
				name = cylinderHalf
				relativePosition = 0.0
			}
			TRANSFORM
			{
				name = tankBottom
				relativePosition = -0.5
			}
			TRANSFORM
			{
				name = baseHorizontalTop
				relativePosition = 0.5
			}
			TRANSFORM
			{
				name = baseHorizontalBottom
				relativePosition = -0.5
			}
		}
		SUBTYPE
		{
			name = 2
			title = 2 (3.75m)
			primaryColor = White
			secondaryColor = White
			addedCost = 1.0
			addedMass = 1.0
			volumeAddedToParent = 1.0
			transform = cylinder1
			transform = lidHorizontal
			transform = baseHorizontalTop
			transform = baseHorizontalBottom
			NODE
			{
				name = top
				relativePosition = 2.0
			}
			NODE
			{
				name = bottom
				relativePosition = -2.0
			}
			TRANSFORM
			{
				name = tankTop
				relativePosition = 1.0
			}
			TRANSFORM
			{
				name = tankBottom
				relativePosition = -1.0
			}
			TRANSFORM
			{
				name = baseHorizontalTop
				relativePosition = 1.0
			}
			TRANSFORM
			{
				name = baseHorizontalBottom
				relativePosition = -1.0
			}
		}
		SUBTYPE
		{
			name = 2.5
			title = 2.5 (4.6875m)
			primaryColor = White
			secondaryColor = White
			addedCost = 1.5
			addedMass = 1.5
			volumeAddedToParent = 1.5
			transform = cylinderHalf
			transform = cylinder1
			transform = lidHorizontal
			transform = baseHorizontalTop
			transform = baseHorizontalBottom
			NODE
			{
				name = top
				relativePosition = 2.5
			}
			NODE
			{
				name = bottom
				relativePosition = -2.5
			}
			TRANSFORM
			{
				name = tankTop
				relativePosition = 1.5
			}
			TRANSFORM
			{
				name = cylinder1
				relativePosition = 0.5
			}
			TRANSFORM
			{
				name = cylinderHalf
				relativePosition = -1.0
			}
			TRANSFORM
			{
				name = tankBottom
				relativePosition = -1.5
			}
			TRANSFORM
			{
				name = baseHorizontalTop
				relativePosition = 1.0
			}
			TRANSFORM
			{
				name = baseHorizontalBottom
				relativePosition = -1.0
			}
		}
		SUBTYPE
		{
			name = 3
			title = 3 (5.625m)
			primaryColor = White
			secondaryColor = White
			addedCost = 2.0
			addedMass = 2.0
			volumeAddedToParent = 2.0
			transform = cylinder1
			transform = cylinder2
			transform = lidHorizontal
			transform = baseHorizontalTop
			transform = baseHorizontalBottom
			NODE
			{
				name = top
				relativePosition = 3.0
			}
			NODE
			{
				name = bottom
				relativePosition = -3.0
			}
			TRANSFORM
			{
				name = tankTop
				relativePosition = 2.0
			}
			TRANSFORM
			{
				name = cylinder1
				relativePosition = 1.0
			}
			TRANSFORM
			{
				name = cylinder2
				relativePosition = -1.0
			}
			TRANSFORM
			{
				name = tankBottom
				relativePosition = -2.0
			}
			TRANSFORM
			{
				name = baseHorizontalTop
				relativePosition = 1.5
			}
			TRANSFORM
			{
				name = baseHorizontalBottom
				relativePosition = -1.5
			}
		}
		SUBTYPE
		{
			name = 3.5
			title = 3.5 (6.5625m)
			primaryColor = White
			secondaryColor = White
			addedCost = 2.5
			addedMass = 2.5
			volumeAddedToParent = 2.5
			transform = cylinder1
			transform = cylinder2
			transform = cylinderHalf
			transform = lidHorizontal
			transform = baseHorizontalTop
			transform = baseHorizontalBottom
			NODE
			{
				name = top
				relativePosition = 3.5
			}
			NODE
			{
				name = bottom
				relativePosition = -3.5
			}
			TRANSFORM
			{
				name = tankTop
				relativePosition = 2.5
			}
			TRANSFORM
			{
				name = cylinder1
				relativePosition = 1.5
			}
			TRANSFORM
			{
				name = cylinder2
				relativePosition = -0.5
			}
			TRANSFORM
			{
				name = cylinderHalf
				relativePosition = -2.0
			}
			TRANSFORM
			{
				name = tankBottom
				relativePosition = -2.5
			}
			TRANSFORM
			{
				name = baseHorizontalTop
				relativePosition = 1.5
			}
			TRANSFORM
			{
				name = baseHorizontalBottom
				relativePosition = -1.5
			}
		}
		SUBTYPE
		{
			name = 4
			title = 4 (7.5m)
			primaryColor = White
			secondaryColor = White
			addedCost = 3.0
			addedMass = 3.0
			volumeAddedToParent = 3.0
			transform = cylinder1
			transform = cylinder2
			transform = cylinder3
			transform = lidHorizontal
			transform = baseHorizontalTop
			transform = baseHorizontalBottom
			NODE
			{
				name = top
				relativePosition = 4.0
			}
			NODE
			{
				name = bottom
				relativePosition = -4.0
			}
			TRANSFORM
			{
				name = tankTop
				relativePosition = 3.0
			}
			TRANSFORM
			{
				name = cylinder1
				relativePosition = 2.0
			}
			TRANSFORM
			{
				name = cylinder2
				relativePosition = 0.0
			}
			TRANSFORM
			{
				name = cylinder3
				relativePosition = -2.0
			}
			TRANSFORM
			{
				name = tankBottom
				relativePosition = -3.0
			}
			TRANSFORM
			{
				name = baseHorizontalTop
				relativePosition = 2.0
			}
			TRANSFORM
			{
				name = baseHorizontalBottom
				relativePosition = -2.0
			}
		}
		SUBTYPE
		{
			name = 4.5
			title = 4.5 (8.4375m)
			primaryColor = White
			secondaryColor = White
			addedCost = 3.5
			addedMass = 3.5
			volumeAddedToParent = 3.5
			transform = cylinder1
			transform = cylinder2
			transform = cylinder3
			transform = cylinderHalf
			transform = lidHorizontal
			transform = baseHorizontalTop
			transform = baseHorizontalBottom
			NODE
			{
				name = top
				relativePosition = 4.5
			}
			NODE
			{
				name = bottom
				relativePosition = -4.5
			}
			TRANSFORM
			{
				name = tankTop
				relativePosition = 3.5
			}
			TRANSFORM
			{
				name = cylinder1
				relativePosition = 2.5
			}
			TRANSFORM
			{
				name = cylinder2
				relativePosition = 0.5
			}
			TRANSFORM
			{
				name = cylinder3
				relativePosition = -1.5
			}
			TRANSFORM
			{
				name = cylinderHalf
				relativePosition = -3.0
			}
			TRANSFORM
			{
				name = tankBottom
				relativePosition = -3.5
			}
			TRANSFORM
			{
				name = baseHorizontalTop
				relativePosition = 2.0
			}
			TRANSFORM
			{
				name = baseHorizontalBottom
				relativePosition = -2.0
			}
		}
		SUBTYPE
		{
			name = 5
			title = 5 (9.375m)
			primaryColor = White
			secondaryColor = White
			addedCost = 4.0
			addedMass = 4.0
			volumeAddedToParent = 4.0
			transform = cylinder1
			transform = cylinder2
			transform = cylinder3
			transform = cylinder4
			transform = lidHorizontal
			transform = baseHorizontalTop
			transform = baseHorizontalBottom
			NODE
			{
				name = top
				relativePosition = 5.0
			}
			NODE
			{
				name = bottom
				relativePosition = -5.0
			}
			TRANSFORM
			{
				name = tankTop
				relativePosition = 4.0
			}
			TRANSFORM
			{
				name = cylinder1
				relativePosition = 3.0
			}
			TRANSFORM
			{
				name = cylinder2
				relativePosition = 1.0
			}
			TRANSFORM
			{
				name = cylinder3
				relativePosition = -1.0
			}
			TRANSFORM
			{
				name = cylinder4
				relativePosition = -3.0
			}
			TRANSFORM
			{
				name = tankBottom
				relativePosition = -4.0
			}
			TRANSFORM
			{
				name = baseHorizontalTop
				relativePosition = 2.5
			}
			TRANSFORM
			{
				name = baseHorizontalBottom
				relativePosition = -2.5
			}
		}
		SUBTYPE
		{
			name = 5.5
			title = 5.5 (10.3125m)
			primaryColor = White
			secondaryColor = White
			addedCost = 4.5
			addedMass = 4.5
			volumeAddedToParent = 4.5
			transform = cylinder1
			transform = cylinder2
			transform = cylinder3
			transform = cylinder4
			transform = cylinderHalf
			transform = lidHorizontal
			transform = baseHorizontalTop
			transform = baseHorizontalBottom
			NODE
			{
				name = top
				relativePosition = 5.5
			}
			NODE
			{
				name = bottom
				relativePosition = -5.5
			}
			TRANSFORM
			{
				name = tankTop
				relativePosition = 4.5
			}
			TRANSFORM
			{
				name = cylinder1
				relativePosition = 3.5
			}
			TRANSFORM
			{
				name = cylinder2
				relativePosition = 1.5
			}
			TRANSFORM
			{
				name = cylinder3
				relativePosition = -0.5
			}
			TRANSFORM
			{
				name = cylinder4
				relativePosition = -2.5
			}
			TRANSFORM
			{
				name = cylinderHalf
				relativePosition = -4.0
			}
			TRANSFORM
			{
				name = tankBottom
				relativePosition = -4.5
			}
			TRANSFORM
			{
				name = baseHorizontalTop
				relativePosition = 2.5
			}
			TRANSFORM
			{
				name = baseHorizontalBottom
				relativePosition = -2.5
			}
		}
		SUBTYPE
		{
			name = 6
			title = 6 (11.25m)
			primaryColor = White
			secondaryColor = White
			addedCost = 5.0
			addedMass = 5.0
			volumeAddedToParent = 5.0
			transform = cylinder1
			transform = cylinder2
			transform = cylinder3
			transform = cylinder4
			transform = cylinder5
			transform = lidHorizontal
			transform = baseHorizontalTop
			transform = baseHorizontalBottom
			NODE
			{
				name = top
				relativePosition = 6.0
			}
			NODE
			{
				name = bottom
				relativePosition = -6.0
			}
			TRANSFORM
			{
				name = tankTop
				relativePosition = 5.0
			}
			TRANSFORM
			{
				name = cylinder1
				relativePosition = 4.0
			}
			TRANSFORM
			{
				name = cylinder2
				relativePosition = 2.0
			}
			TRANSFORM
			{
				name = cylinder4
				relativePosition = -2.0
			}
			TRANSFORM
			{
				name = cylinder5
				relativePosition = -4.0
			}
			TRANSFORM
			{
				name = tankBottom
				relativePosition = -5.0
			}
			TRANSFORM
			{
				name = baseHorizontalTop
				relativePosition = 3.0
			}
			TRANSFORM
			{
				name = baseHorizontalBottom
				relativePosition = -3.0
			}
		}
	}
}
@PART[chemical-storage-tank-500]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[lengthSwitch]]
	{
		@SUBTYPE[1]
		{
			@title = 1 (3.75m)
		}
		@SUBTYPE[1.5]
		{
			@title = 1.5 (5.625m)
		}
		@SUBTYPE[2]
		{
			@title = 2 (7.5m)
		}
		@SUBTYPE[2.5]
		{
			@title = 2.5 (9.375m)
		}
		@SUBTYPE[3]
		{
			@title = 3 (11.25m)
		}
		@SUBTYPE[3.5]
		{
			@title = 3.5 (13.125m)
		}
		@SUBTYPE[4]
		{
			@title = 4 (15m)
		}
		@SUBTYPE[4.5]
		{
			@title = 4.5 (16.875m)
		}
		@SUBTYPE[5]
		{
			@title = 5 (18.75m)
		}
		@SUBTYPE[5.5]
		{
			@title = 5.5 (20.625m)
		}
		@SUBTYPE[6]
		{
			@title = 6 (22.5m)
		}
	}
}

// Size-specific model changes
@PART[chemical-storage-tank-250-*]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[lengthSwitch]]
	{
		@SUBTYPE[1]
		{
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 60.0, 0.0
			}
		}
		@SUBTYPE[1.5]
		{
			transform = baseHorizontalTop
			transform = baseHorizontalBottom
		}
		@SUBTYPE[2]
		{
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 60.0, 0.0
			}
		}
		@SUBTYPE[3]
		{
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 60.0, 0.0
			}
		}
		@SUBTYPE[4]
		{
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 60.0, 0.0
			}
		}
		@SUBTYPE[5]
		{
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 60.0, 0.0
			}
		}
		@SUBTYPE[6]
		{
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 60.0, 0.0
			}
		}
	}
}
@PART[chemical-storage-tank-375-*]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[lengthSwitch]]
	{
		@SUBTYPE[1]
		{
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 45.0, 0.0
			}
		}
		@SUBTYPE[2]
		{
			@TRANSFORM[baseHorizontalTop]
			{
				@relativePosition = 0.5
			}
			@TRANSFORM[baseHorizontalBottom]
			{
				@relativePosition = -0.5
			}
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 45.0, 0.0
			}
		}
		@SUBTYPE[3]
		{
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 45.0, 0.0
			}
		}
		@SUBTYPE[4]
		{
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 45.0, 0.0
			}
		}
		@SUBTYPE[5]
		{
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 45.0, 0.0
			}
		}
		@SUBTYPE[6]
		{
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 45.0, 0.0
			}
		}
		@SUBTYPE[2.5]
		{
			@TRANSFORM[cylinderHalf]
			{
				%rotationOffset = 0.0, 90.0, 0.0
			}
		}
		@SUBTYPE[4.5]
		{
			@TRANSFORM[cylinderHalf]
			{
				%rotationOffset = 0.0, 90.0, 0.0
			}
		}
		@SUBTYPE:HAS[@TRANSFORM[cylinder2]]
		{
			@TRANSFORM[cylinder2]
			{
				%rotationOffset = 0.0, 90.0, 0.0
			}
		}
		@SUBTYPE:HAS[@TRANSFORM[cylinder2]]
		{
			@TRANSFORM[cylinder4]
			{
				%rotationOffset = 0.0, 90.0, 0.0
			}
		}
	}
}
@PART[chemical-storage-tank-500-*]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[lengthSwitch]]
	{
		@SUBTYPE[1]
		{
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 30.0, 0.0
			}
		}
		@SUBTYPE[1.5]
		{
			transform = baseHorizontalTop
			transform = baseHorizontalBottom
		}
		@SUBTYPE[2]
		{
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 30.0, 0.0
			}
		}
		@SUBTYPE[3]
		{
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 30.0, 0.0
			}
		}
		@SUBTYPE[4]
		{
			transform = baseHorizontalCentre
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 30.0, 0.0
			}
		}
		@SUBTYPE[4.5]
		{
			transform = baseHorizontalCentre
		}
		@SUBTYPE[5]
		{
			transform = baseHorizontalCentre
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 30.0, 0.0
			}
		}
		@SUBTYPE[5.5]
		{
			transform = baseHorizontalCentre
		}
		@SUBTYPE[6]
		{
			transform = baseHorizontalCentre
			TRANSFORM
			{
				name = domeBottom
				rotationOffset = 0.0, 30.0, 0.0
			}
		}
	}
}

// Size-specific cost, mass and volume and position offsets
@PART[chemical-storage-tank-250-*]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[lengthSwitch]]
	{
		@SUBTYPE,*
		{
			@addedCost *= 1600
			@addedMass *= 1.0
			@volumeAddedToParent *= 1600
			@NODE:HAS[#relativePosition],*
			{
				@relativePosition *= 0.9375
			}
			@TRANSFORM:HAS[#relativePosition],*
			{
				@relativePosition *= 0.9375
			}
		}
    }
}
@PART[chemical-storage-tank-375-*]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[lengthSwitch]]
	{
		@SUBTYPE,*
		{
			@addedCost *= 3600
			@addedMass *= 2.25
			@volumeAddedToParent *= 3600
			@NODE:HAS[#relativePosition],*
			{
				@relativePosition *= 0.9375
			}
			@TRANSFORM:HAS[#relativePosition],*
			{
				@relativePosition *= 0.9375
			}
		}
    }
}
@PART[chemical-storage-tank-500-*]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[lengthSwitch]]
	{
		@SUBTYPE,*
		{
			@addedCost *= 12800
			@addedMass *= 8.0
			@volumeAddedToParent *= 12800
			@NODE:HAS[#relativePosition],*
			{
				@relativePosition *= 1.875
			}
			@TRANSFORM:HAS[#relativePosition],*
			{
				@relativePosition *= 1.875
			}
		}
    }
}

// Set position offsets
@PART[chemical-storage-tank-*]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[lengthSwitch]]
	{
		@SUBTYPE,*
		{
			@NODE:HAS[#relativePosition],*
			{
				position = #0.0, $relativePosition$, 0.0
			}
			@TRANSFORM:HAS[#relativePosition],*
			{
				positionOffset = #0.0, $relativePosition$, 0.0
			}
		}
    }
}

// Increase cost of cryo variants
@PART[chemical-storage-tank-*-cryo-light]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[lengthSwitch]]
	{
		@SUBTYPE,*
		{
			@addedCost *= 1.5
		}
    }
}
@PART[chemical-storage-tank-*-cryo-heavy]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[lengthSwitch]]
	{
		@SUBTYPE,*
		{
			@addedCost *= 2
		}
    }
}

// Remove mass from basic and light cryo tanks whose mass is entirely determined by the B9_TANK_TYPE
@PART[chemical-storage-tank-*-basic,chemical-storage-tank-*-cryo-light]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[lengthSwitch]]
	{
		@SUBTYPE,*
		{
			@addedMass *= 0
		}
    }
}